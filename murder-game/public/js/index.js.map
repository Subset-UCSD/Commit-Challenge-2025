{
  "version": 3,
  "sources": ["../../client/index.ts"],
  "sourcesContent": ["import { Ball, ClientMessage, ServerMessage, State } from \"../server/Messaging\";\n\nconst cnv = document.getElementById('cnv') as HTMLCanvasElement;\nconst ws = new WebSocket(window.location.href.replace(/^http/, \"ws\").replace(/\\/$/, \"\").replace(/^https/, \"wss\"));\n\ncnv.width = window.innerWidth;\ncnv.height = window.innerHeight;\n\nconst c = cnv.getContext(\"2d\");\n\nws.addEventListener(\"message\", handleServerMessage);\n\nlet state:State={\n\tballs:{},\n\tbullets:[]\n}\nlet myUserId=-1\n\nfunction handleServerMessage(data: MessageEvent) {\n\tlet msg: ServerMessage | null = null;\n\ttry {\n\t\tmsg = JSON.parse(data.data);\n\t} catch (e) {}\n\tif (!msg) return;\n\n\tswitch (msg.type) {\n\t\tcase \"ping\":\n\t\t\tconsole.log(\"Received ping...\");\n\t\t\tsend({\"type\": \"pong\"});\n\t\t\tbreak;\n\t\tcase 'state':\n\t\t\tstate = msg.state\n\t\t\tbreak\n\t\t\tcase 'you-are':\n\t\t\t\tmyUserId=msg.userId\n\t\t\t\tbreak\n\t}\n}\n\n// let myBall:Ball|undefined\nlet x=0,y=0\nlet lastReportedX = 0\nlet lastReportedY= 0\nsetInterval(() => {\nif (lastReportedX!==x||lastReportedY!==y){\n\tlastReportedX=x\n\tlastReportedY=y\n\tsend({type:'move',x,y})\n}\n},250)\n\nfunction send(data: ClientMessage) {\n\tws.send(JSON.stringify(data));\n}\n\nfunction draw() {\n\tc?.clearRect(0,0,cnv.width,cnv.height)\n\t\n\tc?.fillText('amogus',50, 50)\n\tif (!c){return}\n\tc.fillStyle = 'red'\n\tfor (const {x,y} of state.bullets) {\n\t\tc.fillRect(x-1,y-1,2,2)\n\t\tc.fillText('this is a bullet', x,y)\n\t}\n\tfor (const [i, {x,y,kills,deaths}] of Object.entries(state.balls)) {\n\t\tc.fillStyle = `hsl(${+i * 57}, 50%, 50%)`\n\t\tc.beginPath()\n\t\tc.moveTo(x + 10, y)\n\t\tc.arc(x,y,10,0,Math.PI*2,)\n\t\tc.fill()\n\t\tc.stroke()\n\t\tc.fillText('hi i have kilt ' + kills+',die ' + deaths, x,y-10)\n\t\tif (+i === myUserId) {\n\t\t\tc.fillText('(this is you!!)', x,y+10)\n\t\t}\n\t}\n\trequestAnimationFrame(draw);\n}\ndraw()\n\nwindow.addEventListener('keydown', (e) =>{\n\tif (e.key==='ArrowLeft'){\n\t\tx -= 5\n\t}\n\tif (e.key==='ArrowRight'){\n\t\tx += 5\n\t}\n\tif (e.key==='ArrowUp'){\n\t\ty -= 5\n\t}\n\tif (e.key==='ArrowDown'){\n\t\ty += 5\n\t}\n\tstate.balls[myUserId].x=x\n\tstate.balls[myUserId].y=y\n})\n\ndocument.addEventListener('click', e => {\n\tconst dx = e.clientX - x\n\tconst dy = e.clientY - y\n\tconst length=Math.hypot(dx,dy)\n\tsend({type:'bullet',xv:dx/length*30,yv:dy/length*30})\n})\n"],
  "mappings": "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",
  "names": ["x", "y"]
}
