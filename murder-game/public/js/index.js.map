{
  "version": 3,
  "sources": ["../../client/index.ts"],
  "sourcesContent": ["import { Ball, ClientMessage, ServerMessage, State } from \"../server/Messaging\";\n\nconst cnv = document.getElementById('cnv') as HTMLCanvasElement;\nconst ws = new WebSocket(window.location.href.replace(/^http/, \"ws\").replace(/\\/$/, \"\").replace(/^https/, \"wss\"));\n\ncnv.width = window.innerWidth;\ncnv.height = window.innerHeight;\n\nconst c = cnv.getContext(\"2d\");\n\nws.addEventListener(\"message\", handleServerMessage);\n\nlet state:State={\n\tballs:{},\n\tbullets:[]\n}\nlet myUserId=-1\n\nfunction handleServerMessage(data: MessageEvent) {\n\tlet msg: ServerMessage | null = null;\n\ttry {\n\t\tmsg = JSON.parse(data.data);\n\t} catch (e) {}\n\tif (!msg) return;\n\n\tswitch (msg.type) {\n\t\tcase \"ping\":\n\t\t\tconsole.log(\"Received ping...\");\n\t\t\tsend({\"type\": \"pong\"});\n\t\t\tbreak;\n\t\tcase 'state':\n\t\t\tstate = msg.state\n\t\t\tbreak\n\t\t\tcase 'you-are':\n\t\t\t\tmyUserId=msg.userId\n\t\t\t\tbreak\n\t}\n}\n\nfunction send(data: ClientMessage) {\n\tif (ws.readyState == WebSocket.OPEN) ws.send(JSON.stringify(data));\n}\n\nfunction draw() {\n\tc?.clearRect(0,0, window.innerWidth, window.innerHeight);\n\tif (!c){return}\n\tc.fillStyle = 'red'\n\tfor (const {x,y} of state.bullets) {\n\t\tc.fillRect(x-1,y-1,2,2)\n\t\tc.fillText('this is a bullet', x,y)\n\t}\n\tfor (const [i, {x,y,kills,deaths}] of Object.entries(state.balls)) {\n\t\tc.fillStyle = `hsl(${+i * 57}, 50%, 50%)`\n\t\tc.beginPath()\n\t\tc.moveTo(x + 10, y)\n\t\tc.arc(x,y,10,0,Math.PI*2,)\n\t\tc.fill()\n\t\tc.stroke()\n\t\tc.fillText('hi i have kilt ' + kills+',die ' + deaths, x,y-10)\n\t\tif (+i === myUserId) {\n\t\t\tc.fillText('(this is you!!)', x,y+10)\n\t\t}\n\t}\n\trequestAnimationFrame(draw);\n}\ndraw()\n\ntype Vector2 = { x: number; y: number };\n\nlet pos: Vector2 = { x: 0, y: 0 };\nlet movementInput: Vector2 = { x: 0, y: 0 };\nlet keysPressed: Set<string> = new Set();\n\ndocument.addEventListener(\"keydown\", handleKeyDown);\ndocument.addEventListener(\"keyup\", handleKeyUp);\n\nfunction handleKeyDown(event: KeyboardEvent) {\n\tif ([\"w\", \"a\", \"s\", \"d\"].includes(event.key.toLowerCase())) {\n\t\tkeysPressed.add(event.key.toLowerCase());\n\t\tupdateMovementInput();\n\t}\n}\n\nfunction handleKeyUp(event: KeyboardEvent) {\n\tif (keysPressed.has(event.key.toLowerCase())) {\n\t\tkeysPressed.delete(event.key.toLowerCase());\n\t\tupdateMovementInput();\n\t}\n}\n\nfunction updateMovementInput() {\n\tlet x = 0, y = 0;\n\n\tif (keysPressed.has(\"w\")) y -= 1;\n\tif (keysPressed.has(\"s\")) y += 1;\n\tif (keysPressed.has(\"a\")) x -= 1;\n\tif (keysPressed.has(\"d\")) x += 1;\n\n\tconst length = Math.sqrt(x * x + y * y);\n\tif (length > 0) {\n\t\tmovementInput = { x: x / length, y: y / length };\n\t} else {\n\t\tmovementInput = { x: 0, y: 0 };\n\t}\n}\n\nfunction updatePosition(deltaTime: number, speed: number) {\n\tpos.x += movementInput.x * speed * deltaTime;\n\tpos.y += movementInput.y * speed * deltaTime;\n\tsend({\n\t\ttype: \"move\",\n\t\tx: pos.x,\n\t\ty: pos.y\n\t});\n}\n\n// Simulate a game loop\nconst speed = 100; // Units per second\nlet lastTime = performance.now();\n\nfunction gameLoop() {\n\tconst currentTime = performance.now();\n\tconst deltaTime = (currentTime - lastTime) / 1000; // Convert to seconds\n\tlastTime = currentTime;\n\n\tupdatePosition(deltaTime, speed);\n\n\trequestAnimationFrame(gameLoop);\n}\ngameLoop();\n\ndocument.addEventListener('click', e => {\n\tconst dx = e.clientX - pos.x\n\tconst dy = e.clientY - pos.y\n\tconst length=Math.hypot(dx,dy)\n\tsend({type:'bullet',xv:dx/length*30,yv:dy/length*30})\n})\n"],
  "mappings": "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",
  "names": ["speed"]
}
