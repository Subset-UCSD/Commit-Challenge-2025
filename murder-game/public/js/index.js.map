{
  "version": 3,
  "sources": ["../../server/obstickes.ts", "../../client/index.ts"],
  "sourcesContent": ["export type Obstacle = {\n  x:number\n  y:number\n  width:number\n  height: number\n}\n\nconst xywh = (x:number,y:number,width:number,height:number)=>({x,y,width,height})\nconst xxyy = (x1:number,x2:number,y1:number,y2:number)=>({x:Math.min(x1,x2),y:Math.min(y1,y2),width:Math.max(x1,x2)-Math.min(x1,x2),height:Math.max(y1,y2)-Math.min(y1,y2)})\n\nexport const obstacles = [\n  xxyy(-50,-100,-100,1000),\n  xxyy(-100,1000,-50,-100),\n  xxyy(1000,1050,-100,1050),\n  xxyy(-100,1050,1000,1050),\n  xywh(400,400,50,50),\n]\n\nexport const inside = ({x,y}:{x:number,y:number},o:Obstacle)=>o.x<=x&&x<=o.x+o.width && o.y<=y&&y<=o.y+o.height\nexport const insideAny = (p:{x:number,y:number})=>obstacles.some(o=>inside(p,o))", "import { Ball, ClientMessage, ServerMessage, State } from \"../server/Messaging\";\nimport { obstacles } from \"../server/obstickes\";\n\nconst cnv = document.getElementById('cnv') as HTMLCanvasElement;\nconst ws = new WebSocket(window.location.href.replace(/^http/, \"ws\").replace(/\\/$/, \"\").replace(/^https/, \"wss\"));\n\ncnv.width = window.innerWidth;\ncnv.height = window.innerHeight;\n\nconst c = cnv.getContext(\"2d\");\n\nws.addEventListener(\"message\", handleServerMessage);\n\nlet state:State={\n\tballs:{},\n\tbullets:[]\n}\nlet myUserId=-1\n\nfunction handleServerMessage(data: MessageEvent) {\n\tlet msg: ServerMessage | null = null;\n\ttry {\n\t\tmsg = JSON.parse(data.data);\n\t} catch (e) {}\n\tif (!msg) return;\n\n\tswitch (msg.type) {\n\t\tcase \"ping\":\n\t\t\tconsole.log(\"Received ping...\");\n\t\t\tsend({\"type\": \"pong\"});\n\t\t\tbreak;\n\t\tcase 'state':\n\t\t\tstate = msg.state\n\t\t\tbreak\n\t\t\tcase 'you-are':\n\t\t\t\tmyUserId=msg.userId\n\t\t\t\tbreak\n\t\t\t\tcase 'please-move':\n\t\t\t\t\tpos.x = msg.x\n\t\t\t\t\tpos.y = msg.y\n\t\t\t\t\tvel.x = 0\n\t\t\t\t\tvel.y=0\n\t\t\t\t\tbreak\n\t\t\t\t\tcase 'die':\n\t\t\t\t\t\tconst bruh=Object.assign(document.createElement('div'),{className:Math.random()<0.5?'variation':'help'})\n\t\t\t\t\tdocument.body.append(bruh)\t\n\t\t\t\t\tsetTimeout(()=>bruh.remove(),500)\n\t\t\t\t\tbreak\n\t}\n}\n\nfunction send(data: ClientMessage) {\n\tif (ws.readyState == WebSocket.OPEN) ws.send(JSON.stringify(data));\n}\n\nfunction mod(a:number,b:number):number {\n\treturn (a%b+b)%b\n}\n\nconst GRID_SIZE = 50\nlet cameraX = 0, cameraY = 0\nfunction draw() {\n\t// const myBall = state.balls[myUserId]\n\t// if (myBall) {\n\n\t// }\n\tcameraX += (pos.x - window.innerWidth / 2 - cameraX) * 0.3\n\tcameraY += (pos.y - window.innerHeight / 2 - cameraY) * 0.3\n\tc?.clearRect(0,0, window.innerWidth, window.innerHeight); \n\tif (!c){return}\n\tc.save()\n\tc.strokeStyle = '#eee'\n\tc.beginPath()\n\tconst startX=mod(-cameraX, GRID_SIZE)\n\tconst startY=mod(-cameraY, GRID_SIZE)\n\tfor (let x = startX; x <startX+ window.innerWidth;x+=GRID_SIZE){\n\t\tc.moveTo(x,0)\n\t\tc.lineTo(x,window.innerHeight)\n\t}\n\tfor (let y = startY; y <startY+ window.innerHeight;y+=GRID_SIZE){\n\t\tc.moveTo(0,y,)\n\t\tc.lineTo(window.innerWidth,y)\n\t}\n\tc.stroke()\n\tc.translate(-cameraX, -cameraY)\n\tc.fillStyle=`hsl(${Math.sin(Date.now() / 100) * 10 + 30},100%,50%)`\n\tfor (const {x,y,width,height} of obstacles) {\n\t\t//\n\t\tc.fillRect(x,y,width,height)\n\t\t\n\t}\n\tc.strokeStyle='black'\n\t// console.log(cameraX, cameraY)\n\tc.fillStyle = 'red'\n\tfor (const {x,y} of state.bullets) {\n\t\tc.fillRect(x-2,y-2,4,4)\n\t\t// c.fillText('this is a bullet', x,y)\n\t}\n\tfor (let [i, {x,y,kills,deaths}] of Object.entries(state.balls)) {\n\t\tif (+i === myUserId) {\n\t\t\tx = pos.x\n\t\t\ty = pos.y\n\t\t\tc.fillText('(this is you!!)', x,y+10)\n\t\t}\n\t\tc.fillStyle = `hsl(${+i * 57}, 50%, 50%)`\n\t\tc.beginPath()\n\t\tc.moveTo(x + 10, y)\n\t\tc.arc(x,y,10,0,Math.PI*2,)\n\t\tc.fill()\n\t\tc.stroke()\n\t\tc.fillText('hi i have kilt ' + kills+',die ' + deaths, x,y-10)\n\t}\n\tc.restore()\n\t// requestAnimationFrame(draw);\n}\n// draw()\n\ntype Vector2 = { x: number; y: number };\n\nlet pos: Vector2 = { x: 0, y: 0 };\nlet vel: Vector2 = { x: 0, y: 0 };\nlet movementInput: Vector2 = { x: 0, y: 0 };\nlet keysPressed: Set<string> = new Set();\n\ndocument.addEventListener(\"keydown\", handleKeyDown);\ndocument.addEventListener(\"keyup\", handleKeyUp);\n\nconst map = {w:'w',a:'a',s:'s',d:'d',arrowleft:'a',arrowdown:'s',arrowup:'w',arrowright:'d'}\n\nfunction handleKeyDown(event: KeyboardEvent) {\n\tif (map[(event.key.toLowerCase())]) {\n\t\tkeysPressed.add(map[event.key.toLowerCase()]);\n\t\tupdateMovementInput();\n\t}\n}\n\nfunction handleKeyUp(event: KeyboardEvent) {\n\tif (keysPressed.has(map[event.key.toLowerCase()])) {\n\t\tkeysPressed.delete(map[event.key.toLowerCase()]);\n\t\tupdateMovementInput();\n\t}\n}\n\nfunction updateMovementInput() {\n\tlet x = 0, y = 0;\n\n\tif (keysPressed.has(\"w\")) y -= 1;\n\tif (keysPressed.has(\"s\")) y += 1;\n\tif (keysPressed.has(\"a\")) x -= 1;\n\tif (keysPressed.has(\"d\")) x += 1;\n\n\tconst length = Math.sqrt(x * x + y * y);\n\tif (length > 0) {\n\t\tmovementInput = { x: x / length, y: y / length };\n\t} else {\n\t\tmovementInput = { x: 0, y: 0 };\n\t}\n}\n\n// let myPosition = {x:0,y:0,xv:0,yv:0}\n\nfunction updatePosition(deltaTime: number, speed: number) {\n\tvel.x += movementInput.x * speed * deltaTime;\n\tvel.y += movementInput.y * speed * deltaTime;\n\tvel.x *= 0.9\n\tvel.y *= 0.9\n\tpos.x += vel.x  * deltaTime;\n\tpos.y += vel.y  * deltaTime;\n\tsend({\n\t\ttype: \"move\",\n\t\tx: pos.x,\n\t\ty: pos.y\n\t});\n}\n\n// Simulate a game loop\nconst speed = 2000; // Units per second (these numbers no longer mean anytihng)\nlet lastTime = performance.now();\n\nconsole.log('hey')\nfunction gameLoop() {\n\tconst currentTime = performance.now();\n\trequestAnimationFrame(gameLoop);\n\t// no gamer laptops! ~60 fps max.\n\tif (currentTime < lastTime + 1000/80){\n\t\t// console.log('too fast')\n\t\treturn}\n\tconst deltaTime = (currentTime - lastTime) / 1000; // Convert to seconds\n\tlastTime = currentTime;\n\n\tupdatePosition(deltaTime, speed);\n\tdraw()\n\n}\ngameLoop();\n\ndocument.addEventListener('click', e => {\n\tconst dx = e.clientX - pos.x+cameraX//window.innerWidth/2\n\tconst dy = e.clientY - pos.y+cameraY//window.innerHeight/2\n\tconst length=Math.hypot(dx,dy)\n\tsend({type:'bullet',xv:dx/length*30,yv:dy/length*30})\n})\n"],
  "mappings": ";AAOA,IAAM,OAAO,CAAC,GAAS,GAAS,OAAa,YAAiB,EAAC,GAAE,GAAE,OAAM,OAAM;AAC/E,IAAM,OAAO,CAAC,IAAU,IAAU,IAAU,QAAa,EAAC,GAAE,KAAK,IAAI,IAAG,EAAE,GAAE,GAAE,KAAK,IAAI,IAAG,EAAE,GAAE,OAAM,KAAK,IAAI,IAAG,EAAE,IAAE,KAAK,IAAI,IAAG,EAAE,GAAE,QAAO,KAAK,IAAI,IAAG,EAAE,IAAE,KAAK,IAAI,IAAG,EAAE,EAAC;AAEnK,IAAM,YAAY;AAAA,EACvB,KAAK,KAAI,MAAK,MAAK,GAAI;AAAA,EACvB,KAAK,MAAK,KAAK,KAAI,IAAI;AAAA,EACvB,KAAK,KAAK,MAAK,MAAK,IAAI;AAAA,EACxB,KAAK,MAAK,MAAK,KAAK,IAAI;AAAA,EACxB,KAAK,KAAI,KAAI,IAAG,EAAE;AACpB;;;ACbA,IAAM,MAAM,SAAS,eAAe,KAAK;AACzC,IAAM,KAAK,IAAI,UAAU,OAAO,SAAS,KAAK,QAAQ,SAAS,IAAI,EAAE,QAAQ,OAAO,EAAE,EAAE,QAAQ,UAAU,KAAK,CAAC;AAEhH,IAAI,QAAQ,OAAO;AACnB,IAAI,SAAS,OAAO;AAEpB,IAAM,IAAI,IAAI,WAAW,IAAI;AAE7B,GAAG,iBAAiB,WAAW,mBAAmB;AAElD,IAAI,QAAY;AAAA,EACf,OAAM,CAAC;AAAA,EACP,SAAQ,CAAC;AACV;AACA,IAAI,WAAS;AAEb,SAAS,oBAAoB,MAAoB;AAChD,MAAI,MAA4B;AAChC,MAAI;AACH,UAAM,KAAK,MAAM,KAAK,IAAI;AAAA,EAC3B,SAAS,GAAG;AAAA,EAAC;AACb,MAAI,CAAC,IAAK;AAEV,UAAQ,IAAI,MAAM;AAAA,IACjB,KAAK;AACJ,cAAQ,IAAI,kBAAkB;AAC9B,WAAK,EAAC,QAAQ,OAAM,CAAC;AACrB;AAAA,IACD,KAAK;AACJ,cAAQ,IAAI;AACZ;AAAA,IACA,KAAK;AACJ,iBAAS,IAAI;AACb;AAAA,IACA,KAAK;AACJ,UAAI,IAAI,IAAI;AACZ,UAAI,IAAI,IAAI;AACZ,UAAI,IAAI;AACR,UAAI,IAAE;AACN;AAAA,IACA,KAAK;AACJ,YAAM,OAAK,OAAO,OAAO,SAAS,cAAc,KAAK,GAAE,EAAC,WAAU,KAAK,OAAO,IAAE,MAAI,cAAY,OAAM,CAAC;AACxG,eAAS,KAAK,OAAO,IAAI;AACzB,iBAAW,MAAI,KAAK,OAAO,GAAE,GAAG;AAChC;AAAA,EACJ;AACD;AAEA,SAAS,KAAK,MAAqB;AAClC,MAAI,GAAG,cAAc,UAAU,KAAM,IAAG,KAAK,KAAK,UAAU,IAAI,CAAC;AAClE;AAEA,SAAS,IAAI,GAAS,GAAiB;AACtC,UAAQ,IAAE,IAAE,KAAG;AAChB;AAEA,IAAM,YAAY;AAClB,IAAI,UAAU;AAAd,IAAiB,UAAU;AAC3B,SAAS,OAAO;AAKf,cAAY,IAAI,IAAI,OAAO,aAAa,IAAI,WAAW;AACvD,cAAY,IAAI,IAAI,OAAO,cAAc,IAAI,WAAW;AACxD,KAAG,UAAU,GAAE,GAAG,OAAO,YAAY,OAAO,WAAW;AACvD,MAAI,CAAC,GAAE;AAAC;AAAA,EAAM;AACd,IAAE,KAAK;AACP,IAAE,cAAc;AAChB,IAAE,UAAU;AACZ,QAAM,SAAO,IAAI,CAAC,SAAS,SAAS;AACpC,QAAM,SAAO,IAAI,CAAC,SAAS,SAAS;AACpC,WAAS,IAAI,QAAQ,IAAG,SAAQ,OAAO,YAAW,KAAG,WAAU;AAC9D,MAAE,OAAO,GAAE,CAAC;AACZ,MAAE,OAAO,GAAE,OAAO,WAAW;AAAA,EAC9B;AACA,WAAS,IAAI,QAAQ,IAAG,SAAQ,OAAO,aAAY,KAAG,WAAU;AAC/D,MAAE,OAAO,GAAE,CAAE;AACb,MAAE,OAAO,OAAO,YAAW,CAAC;AAAA,EAC7B;AACA,IAAE,OAAO;AACT,IAAE,UAAU,CAAC,SAAS,CAAC,OAAO;AAC9B,IAAE,YAAU,OAAO,KAAK,IAAI,KAAK,IAAI,IAAI,GAAG,IAAI,KAAK,EAAE;AACvD,aAAW,EAAC,GAAE,GAAE,OAAM,OAAM,KAAK,WAAW;AAE3C,MAAE,SAAS,GAAE,GAAE,OAAM,MAAM;AAAA,EAE5B;AACA,IAAE,cAAY;AAEd,IAAE,YAAY;AACd,aAAW,EAAC,GAAE,EAAC,KAAK,MAAM,SAAS;AAClC,MAAE,SAAS,IAAE,GAAE,IAAE,GAAE,GAAE,CAAC;AAAA,EAEvB;AACA,WAAS,CAAC,GAAG,EAAC,GAAE,GAAE,OAAM,OAAM,CAAC,KAAK,OAAO,QAAQ,MAAM,KAAK,GAAG;AAChE,QAAI,CAAC,MAAM,UAAU;AACpB,UAAI,IAAI;AACR,UAAI,IAAI;AACR,QAAE,SAAS,mBAAmB,GAAE,IAAE,EAAE;AAAA,IACrC;AACA,MAAE,YAAY,OAAO,CAAC,IAAI,EAAE;AAC5B,MAAE,UAAU;AACZ,MAAE,OAAO,IAAI,IAAI,CAAC;AAClB,MAAE,IAAI,GAAE,GAAE,IAAG,GAAE,KAAK,KAAG,CAAE;AACzB,MAAE,KAAK;AACP,MAAE,OAAO;AACT,MAAE,SAAS,oBAAoB,QAAM,UAAU,QAAQ,GAAE,IAAE,EAAE;AAAA,EAC9D;AACA,IAAE,QAAQ;AAEX;AAKA,IAAI,MAAe,EAAE,GAAG,GAAG,GAAG,EAAE;AAChC,IAAI,MAAe,EAAE,GAAG,GAAG,GAAG,EAAE;AAChC,IAAI,gBAAyB,EAAE,GAAG,GAAG,GAAG,EAAE;AAC1C,IAAI,cAA2B,oBAAI,IAAI;AAEvC,SAAS,iBAAiB,WAAW,aAAa;AAClD,SAAS,iBAAiB,SAAS,WAAW;AAE9C,IAAM,MAAM,EAAC,GAAE,KAAI,GAAE,KAAI,GAAE,KAAI,GAAE,KAAI,WAAU,KAAI,WAAU,KAAI,SAAQ,KAAI,YAAW,IAAG;AAE3F,SAAS,cAAc,OAAsB;AAC5C,MAAI,IAAK,MAAM,IAAI,YAAY,CAAE,GAAG;AACnC,gBAAY,IAAI,IAAI,MAAM,IAAI,YAAY,CAAC,CAAC;AAC5C,wBAAoB;AAAA,EACrB;AACD;AAEA,SAAS,YAAY,OAAsB;AAC1C,MAAI,YAAY,IAAI,IAAI,MAAM,IAAI,YAAY,CAAC,CAAC,GAAG;AAClD,gBAAY,OAAO,IAAI,MAAM,IAAI,YAAY,CAAC,CAAC;AAC/C,wBAAoB;AAAA,EACrB;AACD;AAEA,SAAS,sBAAsB;AAC9B,MAAI,IAAI,GAAG,IAAI;AAEf,MAAI,YAAY,IAAI,GAAG,EAAG,MAAK;AAC/B,MAAI,YAAY,IAAI,GAAG,EAAG,MAAK;AAC/B,MAAI,YAAY,IAAI,GAAG,EAAG,MAAK;AAC/B,MAAI,YAAY,IAAI,GAAG,EAAG,MAAK;AAE/B,QAAM,SAAS,KAAK,KAAK,IAAI,IAAI,IAAI,CAAC;AACtC,MAAI,SAAS,GAAG;AACf,oBAAgB,EAAE,GAAG,IAAI,QAAQ,GAAG,IAAI,OAAO;AAAA,EAChD,OAAO;AACN,oBAAgB,EAAE,GAAG,GAAG,GAAG,EAAE;AAAA,EAC9B;AACD;AAIA,SAAS,eAAe,WAAmBA,QAAe;AACzD,MAAI,KAAK,cAAc,IAAIA,SAAQ;AACnC,MAAI,KAAK,cAAc,IAAIA,SAAQ;AACnC,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAI,KAAK,IAAI,IAAK;AAClB,MAAI,KAAK,IAAI,IAAK;AAClB,OAAK;AAAA,IACJ,MAAM;AAAA,IACN,GAAG,IAAI;AAAA,IACP,GAAG,IAAI;AAAA,EACR,CAAC;AACF;AAGA,IAAM,QAAQ;AACd,IAAI,WAAW,YAAY,IAAI;AAE/B,QAAQ,IAAI,KAAK;AACjB,SAAS,WAAW;AACnB,QAAM,cAAc,YAAY,IAAI;AACpC,wBAAsB,QAAQ;AAE9B,MAAI,cAAc,WAAW,MAAK,IAAG;AAEpC;AAAA,EAAM;AACP,QAAM,aAAa,cAAc,YAAY;AAC7C,aAAW;AAEX,iBAAe,WAAW,KAAK;AAC/B,OAAK;AAEN;AACA,SAAS;AAET,SAAS,iBAAiB,SAAS,OAAK;AACvC,QAAM,KAAK,EAAE,UAAU,IAAI,IAAE;AAC7B,QAAM,KAAK,EAAE,UAAU,IAAI,IAAE;AAC7B,QAAM,SAAO,KAAK,MAAM,IAAG,EAAE;AAC7B,OAAK,EAAC,MAAK,UAAS,IAAG,KAAG,SAAO,IAAG,IAAG,KAAG,SAAO,GAAE,CAAC;AACrD,CAAC;",
  "names": ["speed"]
}
